# 멀티인덱스 설계에 관한 질문

멀티인덱스(복합 인덱스)를 설계할 때는 조건의 선택성(selectivity)과 쿼리 패턴을 고려하는 것이 중요합니다.

## 멀티인덱스 순서 결정 원칙

멀티인덱스에서 컬럼 순서를 결정할 때 일반적으로 고려해야 할 사항은 다음과 같습니다:

1. **높은 카디널리티(Cardinality)** - 고유 값이 많은 컬럼을 앞에 배치
2. **쿼리 패턴** - 자주 사용되는 WHERE 조건의 순서
3. **범위 조건** - 등호(=) 조건이 범위 조건(>, <, BETWEEN 등)보다 앞에 오는 것이 좋음

## 귀하의 경우 분석

- 유저 아이디: n개 (카디널리티 높음)
- 배너 카테고리: 10개 (카디널리티 낮음)

두 조건이 항상 함께 사용된다면, **유저 아이디를 첫 번째 컬럼으로** 설정하는 것이 일반적으로 더 효율적입니다.

### 이유:
1. 유저 아이디는 카디널리티가 높아 데이터를 더 빠르게 필터링할 수 있습니다.
2. 데이터베이스는 인덱스의 왼쪽부터 순차적으로 사용하므로, 더 많은 행을 제거할 수 있는 컬럼이 앞에 오는 것이 유리합니다.

```sql
CREATE INDEX idx_user_banner ON 테이블명(유저아이디, 배너카테고리);
```

## 예외 상황

만약 다음과 같은 경우라면 순서를 바꿀 수 있습니다:
- 배너 카테고리만으로 검색하는 쿼리가 자주 실행되는 경우
- 특정 배너 카테고리에 속한 유저를 찾는 쿼리가 주로 실행되는 경우

그러나 두 조건이 항상 함께 사용된다면, 카디널리티가 높은 유저 아이디를 첫 번째로 두는 것이 좋습니다.

---

### 기억해두면 좋은 영어 표현
- "Composite index" or "Compound index" - 멀티인덱스(복합 인덱스)
- "Index cardinality" - 인덱스 카디널리티(고유값의 수)
- "Index selectivity" - 인덱스 선택성(얼마나 많은 행을 필터링할 수 있는지)
- "Query pattern" - 쿼리 패턴(쿼리가 어떻게 실행되는지)


# 배너 카테고리가 인덱스 앞에 오는 것이 좋은 케이스

배너 카테고리(카디널리티가 낮은 컬럼)가 복합 인덱스의 첫 번째 위치에 오는 것이 유리한 경우가 있습니다.

## 배너 카테고리를 앞에 두는 것이 좋은 상황

### 1. 특정 배너 카테고리에 대한 집계 쿼리가 빈번할 때
```sql
SELECT COUNT(*) FROM 테이블 WHERE 배너카테고리 = 'A';
SELECT AVG(some_value) FROM 테이블 WHERE 배너카테고리 = 'A';
```

### 2. 배너 카테고리별 그룹화가 자주 필요할 때
```sql
SELECT 배너카테고리, COUNT(*) FROM 테이블 GROUP BY 배너카테고리;
```

### 3. 배너 카테고리로 먼저 필터링 후 유저 ID로 추가 필터링하는 쿼리가 일반적일 때
```sql
SELECT * FROM 테이블 WHERE 배너카테고리 = 'A' AND 유저아이디 = 123;
```

### 4. 범위 스캔(Range Scan)이 필요한 경우
유저 ID에 범위 조건이 자주 사용되고, 배너 카테고리는 정확한 값으로 검색할 때:
```sql
SELECT * FROM 테이블 WHERE 배너카테고리 = 'A' AND 유저아이디 BETWEEN 100 AND 200;
```

### 5. 배너 카테고리별 정렬이 필요한 경우
```sql
SELECT * FROM 테이블 ORDER BY 배너카테고리, 유저아이디;
```

## 실제 사용 시나리오 예시

### 관리자 대시보드
- 관리자가 특정 배너 카테고리에 속한 모든 사용자를 조회하는 기능
- 각 배너 카테고리별 사용자 수를 집계하여 차트로 표시

### 배치 처리
- 배너 카테고리별로 데이터를 처리하는 배치 작업
- 특정 배너 카테고리에 속한 사용자에게 일괄 알림 발송

### 데이터 분석
- 배너 카테고리별 사용자 행동 패턴 분석
- 배너 카테고리별 전환율 비교

## 주의사항

배너 카테고리를 앞에 두더라도, 두 조건이 항상 함께 사용된다면 전체 인덱스는 여전히 효과적으로 작동합니다. 다만, 유저 ID만으로 검색하는 쿼리에는 이 인덱스가 효율적으로 사용되지 않을 수 있습니다.

---

### 기억해두면 좋은 영어 표현
- "Index leading column" - 인덱스의 선행 컬럼
- "Low cardinality column" - 낮은 카디널리티 컬럼
- "Index utilization" - 인덱스 활용도
- "Query execution plan" - 쿼리 실행 계획

### 영어로 질문하기
영어로 이 질문을 하신다면:
"Are there cases where it's better to put the banner category (low cardinality column) as the first column in a composite index instead of user ID (high cardinality column)?"


